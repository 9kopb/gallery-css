$item-display-duration: 5 !default; //seconds
$transition-duration: 3 !default; // seconds
$button-highlight-color: #CCFFCC !default;
$display-duration: $transition-duration + $item-display-duration;
$button-highlight-color: green;

@mixin gallery-start-state    { opacity: 0; }
@mixin gallery-display-state  { opacity: 1; }
@mixin gallery-end-state      { opacity: 0; }

@mixin gallery( $item-count ) {
	$total-duration: $display-duration * $item-count;

	@keyframes controlFade-#{$item-count} {
		0% { color: white; }
	  #{100% * $transition-duration / $total-duration} { color: $button-highlight-color; }
	  #{100% * $display-duration / $total-duration} { color: $button-highlight-color; }
	  #{100% * ($display-duration + $transition-duration) / $total-duration} { color: white; }
	}

	@keyframes galleryAnimation-#{$item-count} {
	  0% { @include gallery-start-state; }
	  #{100% * $transition-duration / $total-duration} { @include gallery-display-state; }
	  #{100% * $display-duration / $total-duration} { @include gallery-display-state; }
	  #{100% * ($display-duration + $transition-duration) / $total-duration} { @include gallery-end-state; }
	}

	.items-#{$item-count} { 
		.control-button { animation: controlFade-#{$item-count} #{$total-duration}s infinite; }
		.item { animation: galleryAnimation-#{$item-count} #{$total-duration}s infinite; }

		@for $j from 1 through $item-count {
			@if $j <= $item-count {
				.control-operator:nth-of-type(#{$j}):target ~ .controls .control-button:nth-of-type(#{$j}) { color: $button-highlight-color; }

				.control-button:nth-of-type(#{$j}),
				.item:nth-of-type(#{$j}) { 
					$delay: #{($j - 1) * ($display-duration) - $transition-duration}s;

					animation-delay: #{$delay};
				}
			}
		}
	}
}	

.gallery {
	.item:first-of-type { position: static; opacity: 1; }
	.item { transition: opacity .5s; width: 100%; position: absolute; top: 0; left: 0; opacity: 0; }

	.control-operator { display: none; } // Stop hash links from scrolling up and down
	.control-operator:target ~ .item { @include gallery-start-state; animation: none; } // Unselected image
	.control-operator:target + .item { @include gallery-display-state; } // Selected image
	.control-operator:target ~ .controls .control-button { animation: none; } // Kill button animation when there is a selected image
}